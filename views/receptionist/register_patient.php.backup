<div class="space-y-6">
    <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold text-gray-900">Register New Patient</h1>
        <a href="/KJ/receptionist/patients" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">
            <i class="fas fa-arrow-left mr-2"></i>Back to Patients
        </a>
    </div>

    <?php if (!empty($error)): ?>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        <?php echo htmlspecialchars($error); ?>
    </div>
    <?php endif; ?>

    <?php if (!empty($success)): ?>
    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
        <i class="fas fa-check-circle mr-2"></i>
        <?php echo htmlspecialchars($success); ?>
    </div>
    <?php endif; ?>

    <form method="POST" action="/KJ/receptionist/register_patient" class="bg-white rounded-lg shadow p-6">
        <input type="hidden" name="csrf_token" value="<?php echo htmlspecialchars($csrf_token); ?>">

        <!-- Patient Information -->
        <div class="mb-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-user mr-3 text-blue-600"></i>Patient Information
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div>
                    <label for="first_name" class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                    <input type="text" id="first_name" name="first_name" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label for="last_name" class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                    <input type="text" id="last_name" name="last_name" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label for="date_of_birth" class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                    <input type="date" id="date_of_birth" name="date_of_birth"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label for="gender" class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                    <select id="gender" name="gender"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                    <input type="tel" id="phone" name="phone"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="email" name="email"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="md:col-span-2 lg:col-span-3">
                    <label for="address" class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                    <textarea id="address" name="address" rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>
                <div>
                    <label for="occupation" class="block text-sm font-medium text-gray-700 mb-2">Occupation</label>
                    <input type="text" id="occupation" name="occupation"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>
        </div>

        <!-- Emergency Contact -->
        <div class="mb-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-phone mr-3 text-red-600"></i>Emergency Contact
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="emergency_contact_name" class="block text-sm font-medium text-gray-700 mb-2">Contact Name</label>
                    <input type="text" id="emergency_contact_name" name="emergency_contact_name"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label for="emergency_contact_phone" class="block text-sm font-medium text-gray-700 mb-2">Contact Phone</label>
                    <input type="tel" id="emergency_contact_phone" name="emergency_contact_phone"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>
        </div>

        <!-- Vital Signs -->
        <div class="mb-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-heartbeat mr-3 text-green-600"></i>Vital Signs
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div>
                    <label for="temperature" class="block text-sm font-medium text-gray-700 mb-2">Temperature (°C)</label>
                    <input type="number" id="temperature" name="temperature" step="0.1" min="30" max="45"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 36.5">
                </div>
                <div>
                    <label for="blood_pressure" class="block text-sm font-medium text-gray-700 mb-2">Blood Pressure</label>
                    <input type="text" id="blood_pressure" name="blood_pressure"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 120/80">
                </div>
                <div>
                    <label for="pulse_rate" class="block text-sm font-medium text-gray-700 mb-2">Pulse Rate (bpm)</label>
                    <input type="number" id="pulse_rate" name="pulse_rate" min="40" max="200"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 72">
                </div>
                <div>
                    <label for="body_weight" class="block text-sm font-medium text-gray-700 mb-2">Body Weight (kg)</label>
                    <input type="number" id="body_weight" name="body_weight" step="0.1" min="1" max="300"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 70.5">
                </div>
                <div>
                    <label for="height" class="block text-sm font-medium text-gray-700 mb-2">Height (cm)</label>
                    <input type="number" id="height" name="height" step="0.1" min="30" max="250"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 170.5">
                </div>
            </div>
        </div>

        <!-- Registration Payment -->
        <div class="mb-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-credit-card mr-3 text-green-600"></i>Consultation Payment
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="consultation_fee" class="block text-sm font-medium text-gray-700 mb-2">Consultation Fee (TZS)</label>
                    <input type="number" id="consultation_fee" name="consultation_fee" step="0.01" min="0"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label for="payment_method" class="block text-sm font-medium text-gray-700 mb-2">Payment Method</label>
                    <select id="payment_method" name="payment_method"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="cash">Cash</option>
                        <option value="card">Card</option>
                        <option value="mobile_money">Mobile Money</option>
                        <option value="insurance">Insurance</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button type="button" onclick="calculateTotal()"
                            class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">
                        Calculate Total
                    </button>
                </div>
            </div>
            <div class="mt-4 p-4 bg-gray-50 rounded-md">
                <div class="flex justify-between items-center">
                    <span class="text-sm font-medium text-gray-700">Total Amount:</span>
                    <span id="total_display" class="text-lg font-bold text-gray-900">TZS 0.00</span>
                </div>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div class="flex justify-end space-x-3">
            <a href="/KJ/receptionist/patients" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                Cancel
            </a>
            <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md">
                <i class="fas fa-save mr-2"></i>Register Patient
            </button>
        </div>
    </form>
</div>

<script>
// Calculate BMI when weight and height are entered
function calculateBMI() {
    const weight = parseFloat(document.getElementById('body_weight').value);
    const height = parseFloat(document.getElementById('height').value);

    if (weight > 0 && height > 0) {
        const heightInMeters = height / 100;
        const bmi = weight / (heightInMeters * heightInMeters);
        console.log('BMI calculated:', bmi.toFixed(1));
    }
}

// Validate vital signs
function validateVitalSigns() {
    const temperature = parseFloat(document.getElementById('temperature').value);
    const pulseRate = parseInt(document.getElementById('pulse_rate').value);
    const bodyWeight = parseFloat(document.getElementById('body_weight').value);
    const height = parseFloat(document.getElementById('height').value);

    if (temperature && (temperature < 30 || temperature > 45)) {
        alert('Temperature should be between 30°C and 45°C');
        return false;
    }

    if (pulseRate && (pulseRate < 40 || pulseRate > 200)) {
        alert('Pulse rate should be between 40 and 200 bpm');
        return false;
    }

    if (bodyWeight && (bodyWeight < 1 || bodyWeight > 300)) {
        alert('Body weight should be between 1 and 300 kg');
        return false;
    }

    if (height && (height < 30 || height > 250)) {
        alert('Height should be between 30 and 250 cm');
        return false;
    }

    return true;
}

// Add event listeners
document.getElementById('body_weight').addEventListener('input', calculateBMI);
document.getElementById('height').addEventListener('input', calculateBMI);

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    if (!validateVitalSigns()) {
        e.preventDefault();
    }
});

// Auto-calculate total for consultation fee
function calculateTotal() {
    const fee = parseFloat(document.getElementById('consultation_fee').value) || 0;
    document.getElementById('total_display').textContent = 'TZS ' + fee.toLocaleString('en-US', {minimumFractionDigits: 2});
}

// Auto-calculate on input
document.getElementById('consultation_fee').addEventListener('input', function() {
    const fee = parseFloat(this.value) || 0;
    document.getElementById('total_display').textContent = 'TZS ' + fee.toLocaleString('en-US', {minimumFractionDigits: 2});
});
</script>
